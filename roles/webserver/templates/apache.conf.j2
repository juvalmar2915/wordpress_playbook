# roles/webserver/templates/apache.conf.j2
<VirtualHost *:{{ apache_listen_port }}>
    ServerAdmin webmaster@localhost
    ServerName {{ wordpress_site_url | regex_replace('^(http|https)://', '') }}
    DocumentRoot {{ wordpress_install_dir }}

    <Directory {{ wordpress_install_dir }}>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    {% if ansible_os_family == 'RedHat' %}
    ErrorLog /var/log/httpd/error.log
    CustomLog /var/log/httpd/access.log combined
    {% elif ansible_os_family == 'Debian' %}
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined
    {% else %}
    {# Fallback for other OS families, or if specific log paths aren't critical #}
    ErrorLog /var/log/apache/error.log
    CustomLog /var/log/apache/access.log combined
    {% endif %}

    <FilesMatch \.php$>
        {% if ansible_os_family == 'RedHat' %}
        SetHandler "proxy:unix:/run/php-fpm/www.sock|fcgi://localhost"
        {% elif ansible_os_family == 'Debian' %}
        SetHandler "proxy:unix:/run/php/php{{ php_version }}-fpm.sock|fcgi://localhost"
        {% else %}
        # Fallback or error for unsupported OS families
        SetHandler "proxy:fcgi://127.0.0.1:9000"
        {% endif %}
    </FilesMatch>

</VirtualHost>
